# Project: Rollplay - Development Update

```
commit        : a16994a
release       : 0.21.0
release Date  : 2026 FEB 03
tag           : rollplay-0.21.0
```

---

## State Management — TanStack Query

- **NEW:** TanStack Query (React Query) integrated for all dashboard data fetching and mutations
- **NEW:** Dedicated query hooks: `useCampaigns`, `useCharacters`, `useFriendships`, `useNotifications`
- **NEW:** Dedicated mutation hooks for campaigns, characters, friendships, notifications, and sessions
- **ENHANCED:** Automatic cache invalidation on all mutations replaces manual state management
- **IMPROVED:** Eliminated `refreshTrigger` prop drilling — components now derive state from query cache

---

## Real-Time Updates

- **NEW:** WebSocket-to-TanStack bridge (`useEventQueryInvalidation`) invalidates query cache on live events
- **NEW:** Character selection and release events broadcast to all campaign members in real-time
- **ENHANCED:** Dashboard event handlers simplified — WebSocket events now invalidate TanStack cache directly

---

## Stale Cache Fixes

- **FIXED:** Deleted characters no longer appear in campaign character selection modal
- **FIXED:** Newly created characters now appear immediately when redirected back to campaign from character creation
- **FIXED:** Character edits and clones now invalidate both campaign and character caches
- **FIXED:** Campaign invite modal uses TanStack cache for consistent member state

---

## Asset Library

- **IMPROVED:** Decomposed monolithic `useAssetLibrary` hook into focused hooks: `useAssets`, `useUploadAsset`, `useDeleteAsset`, `useAssociateAsset`
- **ENHANCED:** Asset operations now use TanStack mutations with proper cache invalidation

---

## Campaign Management

- **IMPROVED:** CampaignManager reduced from ~1000 lines by extracting data fetching into query hooks
- **ENHANCED:** Campaign mutations (create, update, delete, leave, remove player) handled by dedicated hooks
- **ENHANCED:** Invited campaign members fetched via `useInvitedCampaignMembers` query hook

---

## Social & Notifications

- **ENHANCED:** FriendsManager and FriendsWidget migrated to `useFriendships` and `useFriendshipMutations`
- **ENHANCED:** NotificationBell and AccountNotificationFeed use `useNotifications` and `useNotificationMutations`
- **IMPROVED:** Friend actions (add, accept, decline, remove, buzz) use mutation hooks with cache invalidation

---

This release replaces manual fetch-and-setState patterns across the dashboard with TanStack Query, providing automatic cache management, consistent data across tabs, and real-time cache invalidation via WebSocket events. Also includes targeted fixes for stale cache bugs in the character selection flow.
